<div>
  @if (table.getIsAllRowsSelected() || table.getIsSomeRowsSelected()) {
    <button size="sm" hlmBtn variant="destructive" (click)="onDeleteSelected()">
      Delete Selected
    </button>
  }
  <div
    class="mt-4 block h-[18rem] w-full overflow-auto rounded-md border border-border">
    <!-- we defer the loading of the table, because tanstack manipulates the DOM with flexRender which can cause errors during SSR -->
    @defer {
      <table hlmTable class="w-full">
        <thead hlmTHead>
          @for (headerGroup of table.getHeaderGroups(); track headerGroup.id) {
            <tr hlmTr>
              @for (header of headerGroup.headers; track header.id) {
                <th hlmTh [attr.colSpan]="header.colSpan">
                  @if (!header.isPlaceholder) {
                    <ng-container
                      *flexRender="
                        header.column.columnDef.header;
                        props: header.getContext();
                        let headerText
                      ">
                      <div [innerHTML]="headerText"></div>
                    </ng-container>
                  }
                </th>
              }
            </tr>
          }
        </thead>
        <tbody hlmTBody class="w-full">
          @for (row of table.getRowModel().rows; track row.id) {
            <tr
              hlmTr
              [attr.key]="row.id"
              [attr.data-state]="row.getIsSelected() && 'selected'">
              @for (cell of row.getVisibleCells(); track $index) {
                <td hlmTd>
                  <ng-container
                    *flexRender="
                      cell.column.columnDef.cell;
                      props: cell.getContext();
                      let cell
                    ">
                    <div [innerHTML]="cell"></div>
                  </ng-container>
                </td>
              }
            </tr>
          } @empty {
            <tr hlmTr>
              <td
                hlmTd
                class="h-24 text-center"
                [attr.colspan]="columns.length">
                No results.
              </td>
            </tr>
          }
        </tbody>
      </table>
    }
  </div>

  <div class="mt-4 flex flex-col justify-between sm:flex-row sm:items-center">
    @if (table.getRowCount() > 0) {
      <span class="${hlmMuted} text-sm">
        {{ table.getSelectedRowModel().rows.length }} of
        {{ table.getRowCount() }} row(s) selected
      </span>
      <div class="mt-2 flex sm:mt-0">
        <brn-select
          class="inline-block"
          [ngModel]="table.getState().pagination.pageSize"
          (ngModelChange)="table.setPageSize($event); table.resetPageIndex()">
          <hlm-select-trigger class="w-15 mr-1 inline-flex h-9">
            <hlm-select-value />
          </hlm-select-trigger>
          <hlm-select-content>
            @for (size of availablePageSizes; track size) {
              <hlm-option [value]="size">
                {{ size === 10000 ? 'All' : size }}
              </hlm-option>
            }
          </hlm-select-content>
        </brn-select>

        <div class="flex space-x-1">
          <button
            size="sm"
            variant="outline"
            hlmBtn
            [disabled]="!table.getCanPreviousPage()"
            (click)="table.previousPage()">
            Previous
          </button>
          <button
            size="sm"
            variant="outline"
            hlmBtn
            [disabled]="!table.getCanNextPage()"
            (click)="table.nextPage()">
            Next
          </button>
        </div>
      </div>
    }
    <!--@else {
      <div class="flex h-full w-full items-center justify-center">
        <div class="text-sm text-muted-foreground">No Data</div>
      </div>
    }-->
  </div>
</div>
